#!/usr/bin/env bash

export PROJECT_NAME='TKN-.-project_name-.-TKN'
export ORGANIZATION_NAME='TKN-.-project_parent_name-.-TKN'
export COMPANY_NAME='microstrategy'
export ECOSYSTEM_ROOT_VERSION=${ECOSYSTEM_ROOT_VERSION:='1.0.157.next'}

#<(((((((((((((((-------------------------------------------------------------------)))))))))))))))>#
#<(((((((((((((((------------------- PLEASE DON'T EDIT BELOW -----------------------)))))))))))))))>#


export ECOSYSTEM_ROOT_PATHS_PARENT_HOME='/usr/local'
export ECOSYSTEM_ROOT_NAME='eco.root'
export ECOSYSTEM_ROOT_PATHS_HOME="${ECOSYSTEM_ROOT_PATHS_PARENT_HOME}/${ECOSYSTEM_ROOT_NAME}-${ECOSYSTEM_ROOT_VERSION}"

if [[ -z "$USER" ]]; then
  if [[ -n "$JENKINS_HOME" ]]; then
    export USER=jenkins
  else
    kill -s INT $$
  fi
fi

if [[ ! -e "${ECOSYSTEM_ROOT_PATHS_HOME}/.git" ]]; then
  cd "${ECOSYSTEM_ROOT_PATHS_PARENT_HOME}"

  sudo mkdir "${ECOSYSTEM_ROOT_PATHS_HOME}"
  sudo chown $USER "${ECOSYSTEM_ROOT_PATHS_HOME}"

  git clone https://github.microstrategy.com/ecosystem-incubator/eco.root.git "${ECOSYSTEM_ROOT_PATHS_HOME}"

  cd ${ECOSYSTEM_ROOT_PATHS_HOME}
  git checkout tags/"${ECOSYSTEM_ROOT_VERSION}"

  cd "${ECOSYSTEM_ROOT_PATHS_PARENT_HOME}"
fi

export ECOSYSTEM_ROOT_PATHS_SHELL_HOME="${ECOSYSTEM_ROOT_PATHS_HOME}/shell"
export ECOSYSTEM_ROOT_PATHS_SHELL_LIB_HOME="${ECOSYSTEM_ROOT_PATHS_SHELL_HOME}/lib"
export ECOSYSTEM_ROOT_PATHS_SHELL_LIB_CONTROL_HOME="${ECOSYSTEM_ROOT_PATHS_SHELL_LIB_HOME}/control"

source "${ECOSYSTEM_ROOT_PATHS_SHELL_LIB_CONTROL_HOME}/bootstrap.bash"


cd "${ECOSYSTEM_ROOT_PATHS_HOME}"
if ! git branch | grep '\*' | grep -q detached ; then
  warn "
#####################################################################################################
                      WARNING ECO.ROOT IS ON A BRANCH NOT A SPECIFIC VERSION(TAG)
                    YOUR WARRANTY IS VOID, IE YOUR ARE ON YOUR OWN WITHOUT SUPPORT
#####################################################################################################
"
fi
cd "${PATHS_PROJECT_HOME}"

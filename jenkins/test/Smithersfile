job 'stage-2-regression-test' do
  description 'the second stage in the pipeline
designed to execute all acceptance tests against a
dedicated runtime environment managed by this job'
  
  configure_common_items{}

  assigned_node_number 2

  builders do
    bash do
      script '#!/usr/bin/env bash
set +xe

export PATH=/usr/local/sbin:/usr/local/bin:$PATH

export WORKSPACE_SETTING=esxi_test
source .ecosystem

rake deploy acceptance_test
'
    end
  end

  publishers do
    junit do
      result_glob_path 'test/acceptance/**/target/surefire-reports/*.xml'
    end

    html do
      report_name 'Vagrant Logs'
      report_directory_path "deploy/vagrant/esxi/test/logs"
      index_file_name 'index.html'
    end

    parameterized_trigger do
      job_short_names %w{
        stage-3-demo
      }
    end
  end

end

job 'stage-2-init-postmerge-test-win' do
  description 'this is a job that only starts the slave with ec2-plugin, no actual test inside this job'

  configure_common_items{}

  properties do
    inject do
      properties_content "MSYS=winsymlinks:nativestrict
        PATH=/usr/local/.rbenv/shims:/usr/local/ruby-install/bin:/usr/local/rbenv/libexec:/tools/msys/20160205-3/cmd:/tools/Sysinternals:/Users/vagrant/bin:/Users/vagrant/.rbenv/versions/2.2.4/bin:/cmd:/usr/local/bin:/mingw64/bin:/usr/bin:/Windows/system32:/Windows:/Windows/System32/Wbem:/Windows/System32/WindowsPowerShell/v1.0:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl:/c/Program\ Files/Amazon/AWSCLI"
    end

    parameters do
      upstream_parameter do
        upstream_job_name 'stage-1-dev'
        name 'APPLICATION_VERSION'
        description 'the version of the application to deploy and test'
      end

      upstream_parameter do
        upstream_job_name 'stage-1-dev'
        name 'APPLICATION_COMMIT_HASH'
        description 'the git commit hash paired with the application version (tip: choose the same list item index as the application version)'
      end
    end
  end

  assigned_node_string 'workstation_plugin_e2e_init'

  builders do
    bash do
      script '#!/usr/bin/env bash
      echo APPLICATION_VERSION=$APPLICATION_VERSION
      echo APPLICATION_COMMIT_HASH=$APPLICATION_COMMIT_HASH
'
    end
    parameterized_builder do
      job_names "#{ENV['PROJECT_NAME']}-.-#{Environment.branch_name}-.-stage-2-postmerge-test-win"
      parameters "APPLICATION_VERSION=$APPLICATION_VERSION, APPLICATION_COMMIT_HASH=$APPLICATION_COMMIT_HASH"

      block_and_sync_status true
    end
  end
end

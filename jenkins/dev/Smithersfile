job 'stage-1-dev' do
  description 'The first stage in the pipeline:
designed to complete quickly -- < 10 mins --
and publish a versioned deployment package'

  configure_common_items{}

  assigned_node_string 'amazon_linux'

  triggers do
    github_push do
    end
  end

  builders do
    bash do
      script '#!/usr/bin/env bash
set +xe
export PATH=/usr/local/sbin:/usr/local/bin:$PATH
export WORKSPACE_SETTING=dev
source .ecosystem
rake pre_pipeline
rake package upload_snapshot

'
    end

    parameterized_builder do
      job_names [
        "#{ENV['PROJECT_NAME']}-.-#{Environment.branch_name}-.-stage-2-postmerge-test-mac"
      ]
      block_and_sync_status true
      use_properties_file true
    end

    parameterized_builder do
      job_names [
        "#{ENV['PROJECT_NAME']}-.-#{Environment.branch_name}-.-stage-2-init-postmerge-test-win"
      ]
      block_and_sync_status true
      use_properties_file true
    end


    bash do
      script '#!/usr/bin/env bash
set +xe
export PATH=/usr/local/sbin:/usr/local/bin:$PATH
export WORKSPACE_SETTING=dev
source .ecosystem
rake upload
rake update_dep_db_from_file
rake post_pipeline
'
    end

  end

end
